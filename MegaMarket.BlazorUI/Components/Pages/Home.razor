@page "/"
@inject NavigationManager Nav
@inject AuthenticationStateProvider Auth

<PageTitle>MegaMarket</PageTitle>

@code {
    protected override async Task OnInitializedAsync()
    {
        var state = await Auth.GetAuthenticationStateAsync();
        var user = state.User;

        if (user.Identity?.IsAuthenticated != true)
        {
            Nav.NavigateTo("/login", replace: true);
            return;
        }

        var role = user.FindFirst("role")?.Value?.ToLower();

        var target = role switch
        {
            "admin"     => "/admin/dashboard",
            "manager"   => "/manager/dashboard",
            "cashier"   => "/cashier/dashboard",
            "warehouse" => "/warehouse/dashboard",
            _           => "/login"
        };

        Nav.NavigateTo(target, replace: true);
    }
}
