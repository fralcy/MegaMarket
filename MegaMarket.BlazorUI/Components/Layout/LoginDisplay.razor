@inject AuthService AuthService
@inject NavigationManager NavigationManager

<AuthorizeView>
    <Authorized>
        <div class="user-info-container">
            <div class="user-info-card">
                <div class="avatar-circle-small">
                    <span>@GetInitials(context.User.FindFirst("FullName")?.Value ?? "U")</span>
                </div>
                <div class="user-details">
                    <div class="user-name">@context.User.FindFirst("FullName")?.Value</div>
                    <span class="user-role badge bg-@GetRoleBadgeColor(context.User.FindFirst(ClaimTypes.Role)?.Value ?? "")">
                        @context.User.FindFirst(ClaimTypes.Role)?.Value
                    </span>
                </div>
            </div>
            <button class="btn btn-logout" @onclick="HandleLogout">
                <i class="bi bi-box-arrow-right"></i> Logout
            </button>
        </div>
    </Authorized>
    <NotAuthorized>
        <a href="/login" class="btn btn-sm btn-primary">Login</a>
    </NotAuthorized>
</AuthorizeView>

<style>
    .user-info-container {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-info-card {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 1rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #dee2e6;
    }

    .user-details {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .user-name {
        font-weight: 600;
        font-size: 0.875rem;
        color: #212529;
    }

    .user-role {
        font-size: 0.75rem;
        font-weight: 500;
    }

    .btn-logout {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #dc3545;
        background-color: white;
        border: 1px solid #dc3545;
        border-radius: 6px;
        transition: all 0.2s;
    }

    .btn-logout:hover {
        color: white;
        background-color: #dc3545;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.25);
    }

    .btn-logout i {
        margin-right: 0.25rem;
    }
</style>

@code {
    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("/login", true);
    }

    private string GetInitials(string fullName)
    {
        if (string.IsNullOrEmpty(fullName))
            return "U";

        var parts = fullName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 1)
            return parts[0][0].ToString().ToUpper();

        return $"{parts[0][0]}{parts[^1][0]}".ToUpper();
    }

    private string GetRoleBadgeColor(string role)
    {
        return role switch
        {
            "Admin" => "primary",
            "Employee" => "secondary",
            _ => "secondary"
        };
    }
}
